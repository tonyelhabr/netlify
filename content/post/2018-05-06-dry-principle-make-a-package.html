---
title: The DRY Principle and Knowing When to Make a Package
slug: dry-principle-make-a-package
date: "2018-05-06"
draft: true
categories: []
tags:
 - r
 - package
 - dry
banner: "img/dry-principle-make-a-package/meme.png"
---



<div id="dont-repeat-yourself-dry" class="section level2">
<h2>Don’t Repeat Yourself (DRY)</h2>
<p>Probably everyone who has done some kind of programming has heard of the <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">Don’t Repeat Yourself</a> (DRY) principle. In a nutshell, it’s about reducing code redundancy for the purpose of reducing error and enhancing readability.</p>
<p>Undoubtedly the most common manifestation of the DRY principle is the creation of a function for re-used logic. The “rule of 3” is a good shorthand for identifying when you might want to rethink how your code is organized– “You should consider writing a function whenever you’ve copied and pasted a block of code more than twice (i.e. you now have three copies of the same code)”, per the <a href="http://r4ds.had.co.nz/functions.html"><em>R For Data Science</em> book</a></p>
<p>The DRY principle can be applicable to other settings as well. For example, data scientist <a href="https://twitter.com/drob">David Robinson</a> once remarked (probably only half jokingly) that one should write a blog post after giving the same piece of advice three time. <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
</div>
<div id="dry-and-r-packages" class="section level2">
<h2>DRY and R Packages</h2>
<p>I’d like to suggest applying the DRY principle to package creation–if you use a set of 3 functions at least 3 times, then you should put them in a package. In fact, there need not be more than 1 function or 1 use case–given that the function or use case is significant enough–to justify the initiation of a package.</p>
<p>Well-known R community member <a href="https://rud.is/b">Bob Rud</a>–<a href="https://rud.is/b/2018/04/04/exploring-r-bloggers-posts-with-the-feedly-api/">who is among the most active R developers</a>– has made creating minimal, useful R packages commonplace. In his description of his <a href="https://rud.is/b/2017/09/28/sodd-stackoverflow-driven-development/">Stack Overflow Driven Development</a>, he suggests that not only is such a practice useful for abstracting functionality, but it can also be a great way to enhance one’s skills while helping others.</p>
<p>If one is fearful of creating a package–perhaps due to the potential responsibility of having to maintain it if it is used by others–then I would suggest creating a “personal” package (that you don’t really intend to be used by anyone else). In fact, I believe it is fairly common practice for active R users to have their own personal packages. <a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> For example,</p>
<ul>
<li><a href="http://rud.is/b">Bob Rud</a>’s <a href="https://github.com/hrbrmstr/hrbrmisc"><code>hrbrmisc</code></a> and <a href="https://github.com/hrbrmstr/hrbrthemes"><code>hrbrthemes</code></a></li>
<li><a href="http://varianceexplained.org">David Robinson</a>’s <a href="https://github.com/dgrtwo/drlib"><code>drlib</code></a></li>
<li><a href="https://juliasilge.com">Julia Silge</a>’s <a href="https://github.com/juliasilge/silgelib"><code>silgelib</code></a></li>
<li><a href="http://strengejacke.de">Strenge Jack</a>’s <a href="https://github.com/strengejacke/sjmisc"><code>sjmisc</code></a>, <a href="https://github.com/strengejacke/sjPlot"><code>sjPlot</code></a>, <a href="https://github.com/strengejacke/sjstats"><code>sjstats</code></a>, and <a href="https://github.com/strengejacke/sjlabelled"><code>sjlabelled</code></a></li>
</ul>
<p>Following the examples of others, I have created several personal packages for atomic purposes. <a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></p>
<ul>
<li><a href="https://github.com/tonyelhabr/tetext"><code>tetext</code></a> for <a href="https://www.tidytextmining.com/"><em>Tidy Text Mining</em></a> principles.</li>
<li><a href="https://github.com/tonyelhabr/teplot"><code>teplot</code></a> for plotting functions.</li>
<li><a href="https://github.com/tonyelhabr/teproj"><code>teproj</code></a> for project-related functions.</li>
<li><a href="https://github.com/tonyelhabr/temisc"><code>temisc</code></a> for everything else.</li>
</ul>
<div id="examples" class="section level3">
<h3>Examples</h3>
<p>To give an example of how such a package can be useful, I’ll describe some recent additions to my <code>teplot</code> package to assist with geo-spatial visualization of single U.S. states.</p>
<p>I was working on something related to high schools in Texas (look out for a blog post in the future) and was beginning to copy-paste some functions that I had used for another project for visualizing geo-spatial data in the state. The moment I thought about reusing the code was the moment that I realized that I should put it in a package. Now, visualizing geo-spatial data in Texas is as easy as follows.</p>
<pre class="r"><code>library(&quot;ggplot2&quot;)
library(&quot;teplot&quot;)
library(&quot;ggmap&quot;)
library(&quot;dplyr&quot;)

path &lt;- &quot;https://raw.githubusercontent.com/tonyelhabr/uil-v02/master/data/schools-geo-clean.csv&quot;
schools_geo &lt;- readr::read_csv(path)

viz_map_base &lt;-
  teplot::create_map_state(state = &quot;texas&quot;, show_county = FALSE) +
  teplot::theme_te() +
  teplot::theme_te_map()

viz_map_bycnts &lt;-
  viz_map_base +
  geom_polygon(
    data = schools_geo %&gt;%
      count(state, county) %&gt;%
      inner_join(
        teplot::get_map_data_county_tx(),
        by = c(&quot;county&quot; = &quot;subregion&quot;)
      ),
    aes(fill = n)
  ) +
  scale_fill_gradient(
    trans = &quot;log&quot;,
    low = &quot;white&quot;,
    high = &quot;red&quot;
  ) +
  theme(legend.position = &quot;none&quot;)
viz_map_bycnts</code></pre>
<p><img src="/post/2018-05-06-dry-principle-make-a-package_files/figure-html/viz_map_bycnts-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>I also added a <a href="http://maps.stamen.com/#toner/12/37.7706/-122.3782">stamen map</a> to the package data so that I can use it easily as a base layer.</p>
<pre class="r"><code>viz_map_bycnts_stamen &lt;-
   teplot::ggmap_stamen_tx +
  geom_point(
    data = schools_geo,
    aes(x = lon, y = lat),
    color = &quot;red&quot;,
    size = 1
  )
viz_map_bycnts_stamen</code></pre>
<p><img src="/post/2018-05-06-dry-principle-make-a-package_files/figure-html/viz_map_bycnts_stamen-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>To give a separate example, I used my <code>tetext</code> package for nearly all of the code in <a href="/post/2018-03-11-nba-tweets-tms-flexdashboard/nba-tms.html">the flexdashboard that I created for analyzing the Twitter acccounts of NBA teams.</a> There, I simply called the function <code>tetext::visualize_time_facet()</code> to generate a fairly illustrative visual.</p>
<pre class="r"><code>viz_time_facet_all &lt;-
  data_facet_trim %&gt;%
  tetext::visualize_time_facet(
    timebin = timestamp,
    color = id,
    facet = id,
    scale_manual_params = list(values = colors_filt),
    facet_params = list(scales = &quot;fixed&quot;),
    labs_params = list(title = NULL)
  )
viz_time_facet_all</code></pre>
<div class="figure">
<img src="/img/nba-tweets-tms-flexdashboard/viz_unigram_cnts_facet.png" />

</div>
</div>
</div>
<div id="getting-started" class="section level2">
<h2>Getting Started</h2>
<p>If one has no experience with creating packages and does not know where to get started, there are plenty of awesome resources out there to learn more about it. [^google] To name a few:</p>
<ul>
<li><a href="https://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/"><em>Hillary Parker’s “famous” blog post</em></a></li>
<li><a href="http://r-pkgs.had.co.nz/"><em>R Packages</em> book</a> by <a href="https://twitter.com/hadleywickham">Hadley Wickham</a></li>
<li><a href="kbroman.org/pkg_primer/">_Karl Broman’s primer</a></li>
<li><a href="stat545.com/packages00_index.html"><em>Jenny Bryan’s class tutorial</em></a></li>
</ul>
<p>(There’s a good reason why these resources show up at the top of a Google search for “R packages”.)</p>
<p>Although it may seem daunting at first, one should realize that the pay-off will be great. (Just think about how much time, effort, and debugging you save when writing a function. Now scale that feeling by the number of functions that you include in your package!) I created my first package to assist with using my company’s color scheme in plots. Up until that point, I had been needlessly copy-pasting the same hex values into each separate project where I wanted to use the color palette. (If this happens to be your use case, then check out <a href="https://drsimonj.svbtle.com/creating-corporate-colour-palettes-for-ggplot2">Dr. Simon J’s blog post</a> on exactly this topic!)</p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>Even if it you don’t program much (or at all), the DRY principle will undoubtedly be applicable to you at some point in time. If you’re working with <code>R</code>, then I suggest using packages as a solution to your DRY problems.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://twitter.com/hadleywickham">Hadley Wickham</a> suggested that a book might be even better.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Although several of these have actually been published on CRAN (suggesting that they are really more than just personal packages), each started out as just a package for the individual.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>It seems common to include one’s initials in the name of a personal package, so I have copied that format.<a href="#fnref3">↩</a></p></li>
</ol>
</div>
